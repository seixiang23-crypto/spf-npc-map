<!DOCTYPE html>
<html>
<head>
  <title>SPF NPC Boundary (Live)</title>

  <style>
    #map {
      height: 100vh;
      width: 100%;
    }
  </style>

  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDE5t8KUNO1hc73bhetGBi1rXghs-lgG3U"></script>
</head>
<body>

<div id="map"></div>

<script>
  async function loadNPC() {
    try {
      const pollUrl =
        "https://api-open.data.gov.sg/v1/public/api/datasets/d_89b44df21fccc4f51390eaff16aa1fe8/poll-download";

      console.log("Fetching poll-download...");
      let response = await fetch(pollUrl);
      console.log("Poll response:", response.status);

      const pollData = await response.json();
      console.log("Poll data:", pollData);

      if (pollData.code !== 0) {
        throw new Error(pollData.errMsg);
      }

      console.log("Fetching GeoJSON...");
      response = await fetch(pollData.data.url);
      console.log("GeoJSON response:", response.status);

      const geojson = await response.json();
      console.log("GeoJSON loaded");

      map.data.addGeoJson(geojson);

      map.data.setStyle({
        fillColor: "#1976D2",
        fillOpacity: 0.3,
        strokeColor: "#0D47A1",
        strokeWeight: 1
      });

    } catch (err) {
      console.error("LOAD NPC FAILED:", err);
      alert(err.message);
    }
  }

  loadNPC();
</script>

</body>
</html>
